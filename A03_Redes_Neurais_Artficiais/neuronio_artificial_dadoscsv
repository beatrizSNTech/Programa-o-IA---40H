import tensorflow as tf
import pandas as pd
import numpy as np
import os

# Limpa a tela e avisos
os.environ['TF_CPP_MIN_LOG_LEVEL'] = '2'

print("ğŸ§  INICIANDO SISTEMA DE APRENDIZADO NEURAL...")

# --- 1. IMPORTAÃ‡ÃƒO E LEITURA (O Estudo) ---
try:
    # A IA lÃª o "livro de estudos" (o CSV que geramos antes)
    arquivo = pd.read_csv('historico_piloto.csv')
    print(f"ğŸ“š Arquivo carregado! {len(arquivo)} exemplos encontrados.")
except FileNotFoundError:
    print("âŒ ERRO: Rode o cÃ³digo do 'Passado' primeiro para gerar o CSV!")
    exit()

# Separa as colunas: 
# X = O que a IA vÃª (DistÃ¢ncia e Velocidade)
# y = O que a IA tem que decidir (Frear ou NÃ£o)
X = arquivo[['distancia', 'velocidade']].values
y = arquivo['resultado_freio'].values

# NORMALIZAÃ‡ÃƒO (Importante: transformar tudo em nÃºmeros entre 0 e 1)
# Como sabemos que o mÃ¡ximo Ã© aprox 200, dividimos por 200.
X_norm = X / 200.0

# --- 2. CRIAÃ‡ÃƒO DO NEURÃ”NIO (A Estrutura) ---
model = tf.keras.Sequential([
    # Camada de Entrada (2 valores) -> Oculta (8 neurÃ´nios)
    tf.keras.layers.Dense(8, input_shape=(2,), activation='relu'),
    # Camada Oculta Extra (4 neurÃ´nios) para entender padrÃµes complexos
    tf.keras.layers.Dense(4, activation='relu'),
    # Camada de SaÃ­da (1 neurÃ´nio): 0 a 1 (Probabilidade)
    tf.keras.layers.Dense(1, activation='sigmoid')
])

model.compile(optimizer='adam', loss='binary_crossentropy', metrics=['accuracy'])

# --- 3. O TREINAMENTO (A PrÃ¡tica) ---
print("\nğŸ‹ï¸  Treinando a rede neural com os dados do arquivo...")
# A IA vai ler o arquivo 50 vezes (epochs) para aprender bem
model.fit(X_norm, y, epochs=50, verbose=0)
print("âœ… Treinamento concluÃ­do! A IA agora sabe dirigir.")

# --- 4. INTERAÃ‡ÃƒO COM O USUÃRIO (O Teste Real) ---
print("\n" + "="*40)
print("   ğŸš— CARRO AUTÃ”NOMO - MODO MANUAL   ")
print("="*40)
print("A IA aprendeu sozinha lendo o CSV. Teste ela agora!")
print("(Digite 'sair' para encerrar)\n")

while True:
    try:
        entrada_dist = input("ğŸ“ DistÃ¢ncia do obstÃ¡culo (m): ")
        if entrada_dist.lower() == 'sair': break
        
        entrada_vel = input("ğŸš€ Velocidade do carro (km/h): ")
        if entrada_vel.lower() == 'sair': break
        
        # Converte o texto do usuÃ¡rio para nÃºmeros
        dist = float(entrada_dist)
        vel = float(entrada_vel)
        
        # --- O NEURÃ”NIO ENTRA EM AÃ‡ÃƒO AQUI ---
        # 1. Prepara os dados (Normaliza igual ao treino)
        dados_novos = np.array([[dist, vel]]) / 200.0
        
        # 2. O neurÃ´nio calcula a previsÃ£o (Sem IFs, apenas matemÃ¡tica de pesos)
        previsao = model.predict(dados_novos, verbose=0)[0][0]
        
        # 3. Exibe o resultado
        chance = previsao * 100
        print(f"\nğŸ§  CÃ©rebro da IA: {chance:.1f}% de certeza de colisÃ£o.")
        
        if previsao > 0.5:
            print("ğŸ›‘ DECISÃƒO: PISAR NO FREIO!\n")
        else:
            print("ğŸŸ¢ DECISÃƒO: SEGUIR VIAGEM.\n")
            
    except ValueError:
        print("âš ï¸  Erro: Digite apenas nÃºmeros.")

